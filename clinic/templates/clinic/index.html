{% extends 'clinic/base.html' %}
{% load static %}

{% block content %}
    <!-- Герой секция -->
    <section id="hero" class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h1 class="display-4 fw-bold mb-4">Забота о ваших любимцах с любовью</h1>
                    <p class="lead mb-4">Профессиональная ветеринарная помощь с индивидуальным подходом к каждому питомцу</p>
                    <div class="search-box">
                        <form class="d-flex" role="search" method="GET" action="{% url 'clinic:search_services' %}">
                            <input class="form-control me-2" type="search" name="q" placeholder="Найти услугу..." 
                                   aria-label="Search">
                            <button class="btn btn-outline-success" type="submit">Найти</button>
                        </form>
                    </div>
                </div>
                <div class="col-lg-6 text-center">
                    <img src="{% static 'clinic/images/Главная.jpg' %}" 
                         alt="Довольные питомцы" class="img-fluid rounded-3 shadow">
                </div>
            </div>
        </div>
    </section>

    <!-- Акции -->
    <section id="promotions" class="container my-5 py-5">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Специальные предложения</h2>
            <p class="text-muted">Воспользуйтесь выгодными акциями для ваших питомцев</p>
        </div>
        <div class="row">
            {% for promotion in active_promotions %}
            <div class="col-md-4 mb-4">
                <div class="card custom-card promotion-card h-100">
                    <div class="card-body">
                        <span class="badge bg-danger mb-2">Акция</span>
                        <h5 class="card-title fw-bold">{{ promotion.title }}</h5>
                        <p class="card-text">{{ promotion.text|truncatewords:25 }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">До {{ promotion.end_date|date:"d.m.Y" }}</small>
                            <button class="btn btn-sm btn-pastel">Подробнее</button>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">Сейчас нет активных акций</p>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Врачи с лучшими отзывами -->
    <section id="doctors" class="container my-5 py-5">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Лучшие врачи по отзывам</h2>
            <p class="text-muted">Специалисты с наивысшими оценками наших клиентов</p>
        </div>
        <div class="row justify-content-center">
            {% for doctor in doctors %}
            <div class="col-md-4 col-lg-4 mb-4">
                <div class="card custom-card doctor-card h-100">
                    <div class="card-body text-center">
                        <img src="{% if doctor.photo %}{{ doctor.photo.url }}{% else %}{% static 'clinic/images/doctor_placeholder.jpg' %}{% endif %}" 
                             alt="{{ doctor.first_name }} {{ doctor.last_name }}" 
                             class="doctor-image mb-3 rounded-circle" 
                             style="width: 150px; height: 150px; object-fit: cover;">
                        
                        <h5 class="card-title fw-bold">Др. {{ doctor.first_name }} {{ doctor.last_name }}</h5>
                        <p class="text-muted">Опыт: {{ doctor.experience }} лет</p>
                        
                        <!-- Рейтинг врача -->
                        <div class="doctor-rating mb-3">
                            <div class="stars">
                                {% with ''|center:doctor.avg_rating as range %}
                                {% for _ in range %}⭐{% endfor %}
                                {% endwith %}
                            </div>
                            <small class="text-muted">
                                {{ doctor.avg_rating|floatformat:1 }}/5 ({{ doctor.reviews_count }} отзывов)
                            </small>
                        </div>
                        
                        <!-- Специализации -->
                        <div class="specializations mb-3">
                            {% for spec in doctor.specializations.all %}
                            <span class="badge bg-primary me-1 mb-1">{{ spec.name }}</span>
                            {% endfor %}
                        </div>
                        
                        {% if doctor.description %}
                        <p class="card-text small">{{ doctor.description|truncatewords:15 }}</p>
                        {% endif %}
                        
                        <a href="{% url 'clinic:doctor_detail' doctor.pk %}" class="btn btn-outline-primary btn-sm">
                            Подробнее о враче
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">Пока нет врачей с отзывами</p>
            </div>
            {% endfor %}
        </div>
        
        <!-- Кнопка для перехода ко всем врачам -->
        <div class="text-center mt-4">
            <a href="{% url 'clinic:doctor_list' %}" class="btn btn-primary">
                Посмотреть всех врачей
            </a>
        </div>
    </section>

    <!-- Отзывы -->
    <section id="reviews" class="container my-5 py-5">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Что говорят наши клиенты</h2>
            <p class="text-muted">Более 1000 довольных питомцев и их хозяев</p>
        </div>
        <div class="row justify-content-center">
            {% for review in reviews %}
            <div class="col-md-10 col-lg-8 col-xl-6 mb-4">
                <div class="card custom-card review-card h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <h6 class="card-title fw-bold mb-0">{{ review.author_name }}</h6>
                            <div class="star-rating">
                                {% for i in "12345" %}
                                <i class="fas fa-star{% if forloop.counter > review.rating %}-o text-muted{% else %} text-warning{% endif %}"></i>
                                {% endfor %}
                            </div>
                        </div>
                        
                        {% if review.doctor %}
                        <p class="small text-muted mb-2">
                            О враче: {{ review.doctor.first_name }} {{ review.doctor.last_name }}
                        </p>
                        {% endif %}
                        
                        <p class="card-text">{{ review.text }}</p>
                        <small class="text-muted">{{ review.created_at|date:"d.m.Y" }}</small>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p class="text-muted">Пока нет отзывов</p>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Контакты -->
    <section id="contacts" class="contacts-section">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="fw-bold">Наши контакты</h2>
                <p class="text-muted">Мы всегда рады помочь вам и вашим питомцам</p>
            </div>
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="map-container">
                        <iframe 
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2245.3727899243865!2d37.61729931582906!3d55.755826680553!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x46b54a5b2a56538d%3A0x6e7ab6b3b4d0d0b!2z0JzQvtGB0LrQvtCy0YHQutC40Lkg0YLRgNC40LvRjNC90LDRjyDQv9C-0LvRjNC30LXQvdC40Y8!5e0!3m2!1sru!2sru!4v1695300000000!5m2!1sru!2sru" 
                            width="100%" 
                            height="400" 
                            style="border-radius: 15px; border: none;" 
                            allowfullscreen="" 
                            loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                    </div>
                </div>
                
                <div class="col-lg-6">
                    <div class="contact-info-card">
                        <h4 class="fw-bold mb-4">Контактная информация</h4>
                        <p class="d-flex align-items-center mb-3">
                            <i class="fas fa-phone contact-icon"></i>
                            <span>+7 (495) 123-45-67</span>
                        </p>
                        <p class="d-flex align-items-center mb-3">
                            <i class="fas fa-envelope contact-icon"></i>
                            <span>info@pitomec.ru</span>
                        </p>
                        <p class="d-flex align-items-center mb-3">
                            <i class="fas fa-map-marker-alt contact-icon"></i>
                            <span>г. Москва, ул. Пушкина, д. 1</span>
                        </p>
                        <p class="d-flex align-items-center mb-4">
                            <i class="fas fa-clock contact-icon"></i>
                            <span>Ежедневно: 9:00 - 21:00</span>
                        </p>
                        <div>
                            <h5 class="fw-bold">Как добраться</h5>
                            <p class="text-muted mb-0">Мы находимся в центре города, рядом с станцией метро "Тверская".</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}